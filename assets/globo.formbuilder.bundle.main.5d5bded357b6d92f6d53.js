(window.webpackJsonpgloboFormbuilder=window.webpackJsonpgloboFormbuilder||[]).push([[5],{8:function(t,r,o){"use strict";o.r(r);var a=o(0);var i={Wizard:class{constructor(e){this.wizard=e,this.panels=new Globo.FormBuilder.Panels(this.wizard),this.steps=new Globo.FormBuilder.Steps(this.wizard),this.stepsQuantity=this.steps.getStepsQuantity(),this.currentStep=this.steps.currentStep,this.nextText=e.querySelector(".action.next").getAttribute("data-next-text"),this.submitText=e.querySelector(".action.next").getAttribute("data-submit-text"),this.submittingText=e.querySelector(".action.next").getAttribute("data-submitting-text"),this.concludeControlMoveStepMethod=this.steps.handleConcludeStep.bind(this.steps),this.wizardConclusionMethod=this.handleWizardConclusion.bind(this)}updateButtonsStatus(){0===this.currentStep?this.previousControl.classList.add("disabled"):this.previousControl.classList.remove("disabled")}updtadeCurrentStep(e){this.currentStep+=e,this.steps.setCurrentStep(this.currentStep),this.panels.setCurrentStep(this.currentStep),this.handleNextStepButton(),this.updateButtonsStatus()}setStep(e){this.currentStep=e,this.steps.setCurrentStep(this.currentStep),this.panels.setCurrentStep(this.currentStep),this.handleNextStepButton(),this.updateButtonsStatus()}handleNextStepButton(){this.nextControl.type="button",this.nextControl.addEventListener("click",this.nextControlMoveStepMethod),this.currentStep===this.stepsQuantity-1?(this.nextControl.innerHTML=this.submitText,this.nextControl.addEventListener("click",this.wizardConclusionMethod)):(this.nextControl.innerHTML=this.nextText,this.nextControl.removeEventListener("click",this.wizardConclusionMethod))}handleWizardConclusion(){this.wizard.classList.add("completed"),this.nextControl.type="submit"}addControls(e,t){this.previousControl=e,this.nextControl=t,this.previousControlMoveStepMethod=this.moveStep.bind(this,-1),this.nextControlMoveStepMethod=this.moveStep.bind(this,1),e.addEventListener("click",this.previousControlMoveStepMethod),t.addEventListener("click",this.nextControlMoveStepMethod),this.updateButtonsStatus()}getCoords(e){var t=e.getBoundingClientRect(),r=document.body,o=document.documentElement,a=window.pageYOffset||o.scrollTop||r.scrollTop,i=window.pageXOffset||o.scrollLeft||r.scrollLeft,s=o.clientTop||r.clientTop||0,l=o.clientLeft||r.clientLeft||0,n=t.top+a-s,c=t.left+i-l;return{top:Math.round(n),left:Math.round(c)}}scrollTop(){var e=Object(a.a)(this.wizard,".globo-formbuilder");if(e.querySelector(".float-layout"));else{let t={behavior:"smooth",left:0},r=!1;void 0!==Globo.FormBuilder.shop.setings?(void 0===Globo.FormBuilder.shop.setings.scrollTop||void 0!==Globo.FormBuilder.shop.setings.scrollTop&&Globo.FormBuilder.shop.setings.scrollTop)&&(r=!0):void 0!==Globo.FormBuilder.shop.settings&&(void 0===Globo.FormBuilder.shop.settings.scrollTop||void 0!==Globo.FormBuilder.shop.settings.scrollTop&&Globo.FormBuilder.shop.settings.scrollTop)&&(r=!0),r&&(t.top=this.getCoords(e).top),window.scrollTo(t)}}moveStep(e){if(Globo.FormBuilder.handleValidate(this.wizard),1==e&&this.wizard.querySelector(".block-container.errors"))return void this.panels.updatePanelsContainerHeight();this.scrollTop(),1==e&&this.concludeControlMoveStepMethod(),this.validateMovement(e)&&(this.updtadeCurrentStep(e),this.steps.handleStepsClasses(e));const t=new CustomEvent("globo.formbuilder.step.move",{detail:{wizard:this.wizard,currentStep:this.currentStep}});document.dispatchEvent(t)}validateMovement(e){const t=e>0&&this.currentStep<this.stepsQuantity-1,r=e<0&&this.currentStep>0;return t||r}reset(){var e=this.wizard.querySelector(".next"),t=this.wizard.querySelector(".previous");this.addControls(t,e),this.steps.handleRemoveAllConcludeStep(),this.setStep(0)}},Steps:class{constructor(e){this.wizard=e,this.steps=this.getSteps(),this.stepsQuantity=this.getStepsQuantity(),this.currentStep=0}setCurrentStep(e){this.currentStep=e}getSteps(){return this.wizard.getElementsByClassName("step")}getStepsQuantity(){return this.getSteps().length}handleConcludeStep(){this.steps[this.currentStep].classList.add("-completed")}handleRemoveAllConcludeStep(){for(var e=0;e<this.stepsQuantity;e++)this.steps[e].classList.remove("-completed")}handleStepsClasses(e){e>0?this.steps[this.currentStep-1].classList.add("-completed"):e<0&&this.steps[this.currentStep].classList.remove("-completed"),this.steps[this.stepsQuantity-1].classList.remove("-completed")}},Panels:class{constructor(e){this.wizard=e,this.panelWidth=this.wizard.offsetWidth,this.panelsContainer=this.getPanelsContainer(),this.panels=this.getPanels(),this.currentStep=0,this.updatePanelsPosition(this.currentStep),this.updatePanelsContainerHeight()}getCurrentPanelHeight(){return this.getPanels()[this.currentStep].offsetHeight+"px"}getPanelsContainer(){return this.wizard.querySelector(".panels")}getPanels(){return this.wizard.getElementsByClassName("panel")}updatePanelsContainerHeight(){this.panelsContainer.style.height=this.getCurrentPanelHeight()}updatePanelsPosition(e){const t=this.panels;this.panelWidth;for(let r=0;r<t.length;r++)t[r].classList.remove("movingIn"),t[r].classList.remove("movingOutBackward"),t[r].classList.remove("movingOutFoward"),t[r].classList.remove("block-container"),r!==e?r<e?t[r].classList.add("movingOutBackward"):r>e&&t[r].classList.add("movingOutFoward"):(t[r].classList.add("movingIn"),t[r].classList.add("block-container"));this.updatePanelsContainerHeight()}setCurrentStep(e){this.currentStep=e,this.updatePanelsPosition(e)}}};var s={BulkOrder:class{showVariants(e){e.forEach(e=>{e.addEventListener("click",(function(e){const t=this.closest(".product-item__action-group"),r=(e,t)=>e.classList.toggle(t);r(t.querySelector(".product-item__action-up"),"product-item__hide"),r(t.querySelector(".product-item__action-down"),"product-item__hide"),r(t.closest(".table-product__body").querySelector(".variant--"+this.getAttribute("data-product-id")),"product-item__hide")}),!1)})}updateSubtotal(e){const t=e.closest(".table-product__body"),r=[...t.querySelectorAll('[name="products[]"]:checked')].reduce((e,t)=>{const r=t.closest(".variant__table-item").querySelector(".item__quantity").value;return e+=parseFloat(t.getAttribute("data-variant-price"))*r},0);t.parentNode.querySelector(".table-product__footer-price").innerText=Object(a.e)(r,1)}selectVariants(e){const t=this;e.forEach((function(e){const r=e.closest(".table-product__body"),o=e.getAttribute("data-product-id"),a=r.querySelector(".variant--"+o);if(e.addEventListener("click",(function(i){if(a){const e=a.querySelectorAll(".variant__table-item:not(.variant__table-item-soldout) .variant-item__checkbox"),t=a.querySelectorAll(".variant__table-item:not(.variant__table-item-soldout) .variant-item__checkbox:checked");if(this.getAttribute("data-variant-id")){const a=r.querySelector(".product--"+o+" .product-item__checkbox");0==t.length?(a.checked=!1,a.classList.remove("checkbox-indeterminate")):(a.checked=!0,t.length<e.length?a.classList.add("checkbox-indeterminate"):a.classList.remove("checkbox-indeterminate"))}else t.length>0&&t.length==e.length?(this.checked=!1,e.forEach((function(e){e.checked=!1}))):(this.checked=!0,this.classList.remove("checkbox-indeterminate"),e.forEach((function(e){e.checked=!0})))}t.updateSubtotal(e)}),!1),!e.getAttribute("data-variant-id")){const t=a.querySelectorAll(".variant__table-item"),i=a.querySelectorAll(".variant__table-item.variant__table-item-soldout");t.length==i.length&&(e.setAttribute("disabled",!0),r.querySelector(".product--"+o).classList.add("variant__table-item-soldout"))}}))}hideUnavailableVariant(e){e.forEach((function(e){0==e.querySelectorAll("table tbody tr").length&&(e.parentNode.querySelector(".product--"+e.getAttribute("data-id")).remove(),e.remove())}))}validateQuantity(e){const t=this;e.forEach((function(e){const r=e.closest(".block-container");e.addEventListener("blur",(function(e){null!==this.getAttribute("max")&&Number(this.value)>Number(this.getAttribute("max"))&&(alert(Globo.FormBuilder.forms[r.getAttribute("data-id")].errorMessage.limitQuantity),this.value=this.getAttribute("max"))}),!1),e.addEventListener("change",(function(r){if(r.target.closest(".product-grid__item").querySelector(".table-product__header-total")){const e=r.target.closest(".variant__table-item"),t=Object(a.e)(e.querySelector(".variant-item__price").getAttribute("data-price"),r.target.value,null);e.querySelector(".variant-item__total").innerHTML=t}t.updateSubtotal(e)}),!1)}))}getProducts(e){let t=e.map(e=>'id:"'+e+'"').join(" OR ");return new Promise((e,r)=>{e(fetch("/search?view=formbuilder&q="+t).then(e=>e.json()).then(e=>e))})}getProductsByHandle(e){return new Promise((t,r)=>{t(fetch("/products/"+e+".js").then(e=>e.json()).then(e=>e))})}sortProducts(e,t,r){let o=[];e.length?o=t:t.map((e,t)=>{o=o.concat(e)});let a=[];return r.map(e=>{const t=o[o.findIndex(t=>t.id===e)];return void 0!==t&&a.push(t),a}),a}getCarts(){return new Promise((e,t)=>{e(fetch("/cart.js",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e))})}updateQuantity(e,t){let r=[];return e.map((e,t)=>{r=r.concat(e.items)}),r.length&&r.map(e=>{let r=t.find(t=>t.id===e.product_id);if(r){let t=r.variants.find(t=>t.id===e.id);t.inventory_quantity=Number(t.inventory_quantity)-Number(e.quantity)}return t}),t}addItems(e,t){return t.closest(".globo-form-control").querySelectorAll(".variant-item__checkbox").forEach(t=>{t.checked&&e.push({id:Number(t.getAttribute("data-variant-id")),quantity:Number(t.closest(".variant__table-item").querySelector(".variant-item__table-quantity input").value)})}),e}addProducts(e,t){return new Promise((t,r)=>{t(fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}).then(e=>e.json()).then(e=>e).catch(e=>{console.error("Add to cart error",e)}))})}reShowMessage(e,t){return e=e.replace(new RegExp("[\r\n]","g"),""),t.map(t=>{e=t.success?e.replace(new RegExp('</div>(\\s+)<div class="message success">((?:(?:(?!<div[^>]*>|</div>).)+|<div[^>]*>.*?</div>)*)</div>',"g"),"</div>"+t.success):e.replace(new RegExp('<div class="message error">((?:(?:(?!<div[^>]*>|</div>).)+|<div[^>]*>.*?</div>)*)</div>',"g"),t.error)}),e}}};var l={Cart:class{constructor(e){this.form=e}setAttributeType(){this.form.setAttribute("type","cart")}updateCartNote(){const e=this;let t={};t["Cart form"]=Object(a.d)(e.form.getAttribute("data-id").toString()),e.form.querySelectorAll("input, textarea, select").forEach((function(r){if("hidden"==r.type){if("_keyLabel"!=r.name){const o=e.getAtrributeName(r.name);t[e.capitalizeFirstLetter(o[0])+" "+o[1]]=r.value?r.value:""}}else e.setAtrributeValue(t,r,!0)})),this.updateAttributes(t)}setAtrributeValue(e,t,r){const o=this,a=o.closestParent(t.parentNode,"globo-form-control").querySelector(".label-content").innerText;if(null!==t.getAttribute("presence")&&(t.classList.add("required"),t.setAttribute("required","")),"checkbox"==t.type)"acceptTerms[]"==t.name?e[a]=t.checked?t.value:"":(e[a]=e[a]||"",t.checked?(e[a]=this.removeCheckboxOption(e[a],""),e[a]+=e[a]?", "+t.value:t.value):(e[a]=this.removeCheckboxOption(e[a],t.value),e[a]=e[a]?e[a]:""));else if("file"==t.type){const r=o.closestParent(t,"globo-form-control"),s=t.files;let l=[];if(Object.values(s).map(e=>{l.push(e.name)}),e[a]=l.length?l.join(", "):"",s.length){const l=Globo.FormBuilder.forms[o.form.getAttribute("data-id")].elements.find(e=>e.id==o.getAtrributeName(t.name)[0]);r.querySelector(".messages").innerHTML='<p class="help-block loading">'+l.uploadPending+"</p>";let n=new FormData;for(var i=0;i<s.length;i++)n.append(o.getAtrributeName(t.name)[0]+"[]",s[i]);n.append("form_id",o.form.getAttribute("data-id")),n.append("name",o.getAtrributeName(t.name)[0]),void 0!==Globo.FormBuilder.url&&fetch(Globo.FormBuilder.url+"/api/front/uploadFiles",{method:"POST",body:n}).then(e=>e.json()).then(i=>{if(i.success){r.classList.remove("has-error"),r.querySelector(".messages").innerHTML='<p class="help-block success">'+l.uploadSuccess+"</p>";for(var n=1;n<=s.length;n++){let r=a+(t.multiple?" download no."+n:" download");e[r]="",!1!==i.fileNames?e[r]=i.fileNames[Number(n)-1]:!1!==i.isUploadable?e[r]=i.isUploadable:!1!==i.isStorageable&&(e[r]=i.isStorageable)}if(t.multiple){const t=Object.keys(e).filter(e=>e.indexOf("download no.")>-1);t.length>s.length&&t.map((t,r)=>{r+1>s.length&&(e[t]="")})}this.updateAttributes(e)}else{const e=Globo.FormBuilder.forms[o.form.getAttribute("data-id")].errorMessage;r.classList.add("has-error"),r.querySelector(".messages").innerHTML="<p class='help-block error'>"+("File not allowed"==i.error||"File size limit"==i.error?e.fileNotAllowed:i.error)+"</p>"}}).catch(e=>{console.error(e)})}else{Object.keys(e).filter(e=>e.indexOf("download")>-1).map(t=>e[t]=""),this.updateAttributes(e),r.classList.remove("has-error"),r.querySelector(".messages").innerHTML=""}}else"radio"==t.type?e[a]=t.checked?t.value:"":e[a]=t.value?t.value:"";r&&this.onActionSetAttribute(e,"change",t)}onActionSetAttribute(e,t,r){const o=this;r.addEventListener(t,(function(t){o.setAtrributeValue(e,t.target,!1),o.updateAttributes(e)}))}getAtrributeName(e){return e.split(/[\[\]]/)}removeCheckboxOption(e,t){return e.indexOf(", "+t)>-1?e.replace(", "+t,""):e.indexOf(t+", ")>-1?e.replace(t+", ",""):e.indexOf(t)>-1?e.replace(t,""):e}capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}closestParent(e,t){return e&&e!=document?e.classList.contains(t)?e:this.closestParent(e.parentNode,t):null}updateAttributes(e){fetch("/cart/update.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attributes:e})}).then(e=>e.json()).then(e=>{console.log("Update cart attributes success",e)}).catch(e=>{console.error("Update cart attributes error",e)})}}};const n=o(20),c=o(22),d=o(68),u={...i,...s,...l,renderForm:async function(e,t,r){let i,s,l,n=this,u=!1;document.querySelector("#globo-formbuilder-dynamicCSS")&&(i=document.querySelector("#globo-formbuilder-dynamicCSS").innerHTML,u=!0),document.querySelector("#globo-formbuilder-template")&&(s=document.querySelector("#globo-formbuilder-template").innerHTML,u=!0),document.querySelector("#globo-formbuilder-element")&&(l=document.querySelector("#globo-formbuilder-element").innerHTML,u=!0);let m=this.forms[e].html;const h=async(e,i,s,l,c,u)=>{if(e||!n.forms[u].html){const{default:e}=await Promise.all([o.e(6),o.e(0)]).then(o.bind(null,84)),t=i||e.templates.dynamicCSS,r=s||e.templates.template,a=l||e.templates.element;c=e.parseAndRenderSync(r,{configs:{...this.forms[u],formId:u},partialElement:a,dynamicCSS:t,formId:u,Globo:Globo})}let m=void 0!==n.page&&void 0!==n.page.type?n.page.type:"page",h=!0;h="cart"==m?!(void 0!==n.forms[u].appearance.formType&&"cartForm"===n.forms[u].appearance.formType&&!n.shop.pricing.features.cartForm):!(void 0!==n.forms[u].appearance.formType&&"bulkOrderForm"===n.forms[u].appearance.formType&&!n.shop.pricing.features.bulkOrderForm),h&&t.forEach(e=>{if(r){const e=new Globo.FormBuilder.BulkOrder;c=e.reShowMessage(c,r)}if(e.classList.contains("globo-formbuilder"))e.innerHTML=c,e.setAttribute("data-id",u);else{const t=Object(a.d)(u);e.innerHTML=e.innerHTML.replace(new RegExp(`{formbuilder:${t}}|{formbuilder:${this.forms[u].v1_id}}`,"gi"),'<div class="globo-formbuilder" id="globo-formbuilder-'+u+'" data-id="'+u+'" type>'+c+"</div>")}const t=e.closest(".globo-form-publish-modal");t&&(e.querySelector(".header.dismiss").classList.remove("hidden"),t.classList.contains("lightbox")&&"false"!==d.get("globo-form-lightbox-"+t.getAttribute("data-id"))&&t.classList.remove("hidden")),(e=e.querySelector(".globo-formbuilder")?e.querySelector(".globo-formbuilder"):e).querySelectorAll("[data-id]").forEach(e=>e.setAttribute("data-id",u)),"cart"==m&&void 0!==n.forms[u].appearance.formType&&"cartForm"==n.forms[u].appearance.formType||e.querySelector(`form[data-id="${u}"]`).setAttribute("action",`${this.url}/api/front/form/${u}/send`),e.querySelector('[name="page[title]"]').value=this.page.title,e.querySelector('[name="page[href]"]').value=this.page.href,this.customer&&(e.querySelector('[name="customer[id]"]')&&(e.querySelector('[name="customer[id]"]').value=this.customer.id),e.querySelector('[name="customer[email]"]')&&(e.querySelector('[name="customer[email]"]').value=this.customer.email),e.querySelector('[name="customer[name]"]')&&(e.querySelector('[name="customer[name]"]').value=this.customer.name)),this.init(e,u)})};let p=this.forms[e].elements.filter(e=>e.id.indexOf("products")>-1);if(p.length){let t=[],r=[];p.map(e=>{Object.values(e.products).map(e=>(t.push(e.id),void 0!==e.handle&&r.push(e.handle)))}),t=c(t),r=c(r);let o=[];const a=new Globo.FormBuilder.BulkOrder;r.length?r.forEach((function(e){o.push(a.getProductsByHandle(e))})):o.push(a.getProducts(t)),await Promise.all(o).then(o=>{let n=a.sortProducts(r,o,t),c=[];c.push(a.getCarts()),Promise.all(c).then(t=>{n=a.updateQuantity(t,n),p.map(e=>{let t=[];return Object.values(e.products).map(e=>t.push(e.id)),e.products=n.filter(e=>t.includes(e.id)),e}),u=!0,h(u,i,s,l,m,e)})})}else u=!0,h(u,i,s,l,m,e)},init:function(e,t){if(!document.body.contains(e))return;e.querySelector(".globo-form").classList.contains("float-form")&&document.body.appendChild(e),e&&e.addEventListener?e.addEventListener("submit",this.handleSubmit,!1):e&&e.attachEvent&&e.attachEvent("onsubmit",this.handleSubmit);let r=document.querySelectorAll('.globo-form-app .block-container[data-id="'+t+'"] [data-type="phone"][validate]');const o=e.querySelector(".globo-formbuilder-wizard");if(o){const a=new this.Wizard(o),i=e.querySelector(".next"),s=e.querySelector(".previous");a.addControls(s,i),a.setStep(0),r=document.querySelectorAll('.globo-form-app .panel[data-id="'+t+'"] [data-type="phone"][validate]')}const a=document.querySelectorAll('.globo-form-app [data-type="datetime"]');a.length&&this.handleDateTimePicker(a),r.length&&this.handlePhoneIntl(t,r);const i=document.querySelectorAll(".globo-form-app .conditional-field");i.length&&this.handleConditionalField(i);const s=document.querySelectorAll(".globo-form-app [name]:not([type='file']):not([type='hidden'])");this.handleHiddenField(this.forms[t],e,s),globoFormbuilderRecaptchaInit=this.handleReCaptcha,this.handleReCaptcha(e);const l=e.querySelectorAll(".globo-form-control");let n={};l.forEach(e=>{var t=e.querySelector("label,legend");if(null!==t&&t){var r=e.querySelector("[name]");if(null!==r&&r){var o=r.getAttribute("name").replace("[]","");n[o]=t.querySelector(".label-content").innerHTML}}}),e.querySelector('[name="_keyLabel"]').value=JSON.stringify(n);let c=void 0!==this.forms[t].appearance.formType?this.forms[t].appearance.formType:"normalForm",d=void 0!==this.page&&void 0!==this.page.type?this.page.type:"page";if("bulkOrderForm"==c){const t=new this.BulkOrder,r=e.querySelectorAll(".globo-form-app .product-item__action-group");r.length&&t.showVariants(r);const o=e.querySelectorAll(".globo-form-app .products-item__checkbox");o.length&&t.selectVariants(o);const a=e.querySelectorAll(".globo-form-app .item__quantity");a.length&&t.validateQuantity(a);const i=e.querySelectorAll(".globo-form-app .variant__hide-unavailable");i.length&&t.hideUnavailableVariant(i)}if("cart"===d&&"cartForm"===c){const t=new this.Cart(e);t.setAttributeType(),t.updateCartNote()}var u=new CustomEvent("globo.formbuilder.form.loaded",{detail:{form:e,formId:t}});document.dispatchEvent(u)},handleReCaptcha:function(e){const t=e?e.querySelectorAll(".globo-g-recaptcha"):document.querySelectorAll(".globo-g-recaptcha");if("undefined"!=typeof grecaptcha&&t)try{t.forEach(e=>{const t=e.getAttribute("data-globo-sitekey")||e.getAttribute("data-sitekey"),r=grecaptcha.render(e,{sitekey:t});console.log("widgetId:",r),e.nextElementSibling.setAttribute("reCaptcha-widget-id",r)})}catch(e){}},showFloatingForm:function(e){e.parentNode.querySelector(".globo-form-app").classList.add("active")},hideFloatingForm:function(e){const t=e.parentNode;t.classList.contains("globo-form-app")?t.classList.remove("active"):t.querySelector(".globo-form-app").classList.remove("active")},openModalForm:function(e){e.closest(".globo-form-publish").querySelector(".globo-form-publish-modal.feedbackButton").style.display="block"},closeModalForm:function(e){const t=e.closest(".globo-form-publish-modal");if(t.style.display="none",t.classList.contains("lightbox")){const e=this.forms[t.getAttribute("data-id")].publish,r="days"==e.selectTime?e.setCookie:365;d.set("globo-form-lightbox-"+t.getAttribute("data-id"),!1,{expires:r})}},showMessage:function(e){if(e){var t=e.querySelector(".content");null!==t&&""!=t.innerHTML&&(e.style.display="block")}},scrollIntoErrorGroup:function(e){e.scrollIntoView({behavior:"smooth",block:"nearest"})},handleValidate:function(e){const t=this,r=e.querySelector(".block-container");let o={};r.querySelectorAll("input, textarea, select").forEach(t=>{const a=null!==t.getAttribute("presence"),i=null!==t.getAttribute("disabled"),s=null!==t.getAttribute("data-type")&&t.getAttribute("data-type");if(o[t.name]={},i?o[t.name].ignore={}:a&&("products[]"==t.name?o[t.name].presence={message:this.forms[r.getAttribute("data-id")].errorMessage.requiredProducts}:o[t.name].presence={message:this.forms[r.getAttribute("data-id")].errorMessage.required}),"email"==s&&(o[t.name][s]={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidEmail}),"name"==s&&(o[t.name].format={pattern:"^[ -.A-ￜ]+",flags:"s",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidName}),"url"==s&&(o[t.name][s]={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidURL}),"phone"==s&&(null!==t.getAttribute("validate")?o[t.name].phone={message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPhone}:o[t.name].format={pattern:"^[+]*[(]{0,1}[0-9+]{1,9}[)]{0,1}[-s.0-9 ]*$",flags:"i",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPhone}),"file"==s){const e=!1!==this.shop.pricing.features.fileUpload?1024*this.shop.pricing.features.fileUpload:2048;o[t.name][s]={notAllowedExtension:this.forms[r.getAttribute("data-id")].errorMessage.fileNotAllowed,sizeLimitMessage:this.forms[r.getAttribute("data-id")].errorMessage.fileSizeLimit,allowedExtension:t.getAttribute("data-allowed-extensions").split(","),maxFileSize:e}}if("checkbox"==s&&(o[t.name][s]={requiredMessage:this.forms[e.getAttribute("data-id")].errorMessage.required},o[t.name][s].isRequired=void 0!==o[t.name].presence),"password"==s){const e=null!==t.getAttribute("data-additional-type")&&t.getAttribute("data-additional-type"),a=null!==t.getAttribute("data-connected-element")&&t.getAttribute("data-connected-element");"confirm-password"===e&&a&&(o[t.name].equality={attribute:a,message:this.forms[r.getAttribute("data-id")].errorMessage.confirmPasswordNotMatch});let i=!(!t.getAttribute("data-validate-rule")||"false"==t.getAttribute("data-validate-rule"))&&t.getAttribute("data-validate-rule");i&&("advancedValidateRule"===i&&(i=null!==t.getAttribute("data-validate-rule")?t.getAttribute("data-advanced-validate-rule"):""),o[t.name].format={pattern:i,flags:"g",message:this.forms[r.getAttribute("data-id")].errorMessage.invalidPassword})}});null!=e.querySelector(".block-container .globo-g-recaptcha")&&(o.reCaptcha={reCaptcha:{isRequired:!0,requiredMessage:this.forms[r.getAttribute("data-id")].errorMessage.requiredCaptcha}}),n.validators.file=function(t,r,o){const a=e.querySelector('[name="'+o+'"]');let i=0,s=!0;return Array.from(a.files).forEach(e=>{i+=e.size,-1===r.allowedExtension.indexOf(function(e){const t=e.split("\\").pop().split("/").pop(),r=t.lastIndexOf(".");return r<1?"":t.substr(r+1)}(e.name).toLowerCase())&&(s=!1)}),i/1e3>r.maxFileSize?r.sizeLimitMessage:s?null:r.notAllowedExtension},n.validators.checkbox=function(t,r,o,a){if(!r.isRequired)return null;const i=e.querySelectorAll("[name='"+o+"']");let s=!1;return i.forEach(e=>{e.checked&&(s=!0)}),s?null:r.requiredMessage},n.validators.reCaptcha=function(t,r,o,a){const i=e.querySelector("[name='"+o+"']");if(i){const e=grecaptcha.getResponse(i.getAttribute("reCaptcha-widget-id"));return i.value=e,""!=i.value?null:r.requiredMessage}return null},n.validators.ignore=function(){return null},n.validators.phone=function(o,a,i,s){const l=e.querySelectorAll("[name='"+i+"'][validate]");let n=!0;return l&&l.forEach(e=>{const o=t.phoneIntl[r.getAttribute("data-id")][i];if(void 0!==o&&e.value.trim()&&!o.isValidNumber()){const e=o.getValidationError();console.log("Phone validate ",0==e?"IS_POSSIBLE":1==e?"INVALID_COUNTRY_CODE":2==e?"TOO_SHORT":3==e?"TOO_LONG":4==e?"IS_POSSIBLE_LOCAL_ONLY":"INVALID_LENGTH"),n=!1}}),n?null:a.message};const a=n(r,o,{fullMessages:!1});!function(e,t){let r=!1;e.querySelectorAll("input[name], select[name], textarea[name]").forEach(e=>{if(l(e,t&&t[e.name]),!r&&t[e.name]){const t=c(e,"globo-form-control");t&&(Globo.FormBuilder.scrollIntoErrorGroup(t),r=!0)}})}(r,a||{}),a&&Object.keys(a).length?r.classList.add("errors"):r.classList.remove("errors");const i=r.querySelectorAll("input:not(.item__quantity):not(.action--add-to-cart), textarea, select");for(var s=0;s<i.length;++s)i.item(s).addEventListener("change",(function(e){const t=n(r,o,{fullMessages:!1})||{};Object.keys(t).length?r.classList.add("errors"):r.classList.remove("errors"),l(this,t[this.name])}));function l(e,t){const r=c(e.parentNode,"globo-form-control"),o=r.querySelector(".messages");!function(e){e.classList.remove("has-error"),e.classList.remove("has-success"),e.querySelectorAll(".help-block.error").forEach(e=>{e.parentNode.removeChild(e)})}(r),t?(r.classList.add("has-error"),t.forEach(e=>{!function(e,t){const r=document.createElement("p");r.classList.add("help-block"),r.classList.add("error"),r.innerText=t,e.appendChild(r)}(o,e)})):r.classList.add("has-success")}function c(e,t){return e&&e!=document?e.classList.contains(t)?e:c(e.parentNode,t):null}},handleLoadDateTimePickerVendor:function(){return Promise.all([o.e(7),o.e(1)]).then(o.bind(null,82))},handleDateTimePicker:function(e){const t=async r=>{const{default:o}=await this.handleLoadDateTimePickerVendor(),{flatpickr:a,locales:i}=o;e.forEach(e=>{let t,o,s,l,n={enableTime:!0,dateFormat:"Y-m-d H:i",time_24hr:!0,disableMobile:!0},c="H:i";t=e.getAttribute("data-format"),o=e.getAttribute("data-locale"),s=e.getAttribute("dataDateFormat")||"Y-m-d",l=e.getAttribute("dataTimeFormat");let d=e.getAttribute("limitDateType"),u=e.getAttribute("limitDateSpecificDates"),m=e.getAttribute("limitDateRangeDates"),h=e.getAttribute("limitDateDOWDates");"12h"==l&&(n.time_24hr=!1,c="h:i K"),"date-and-time"==t?n.dateFormat=s+" "+c:"date"==t?(n.enableTime=!1,n.dateFormat=s):"time"==t&&(n.noCalendar=!0,n.dateFormat=c),o&&(n.locale=i[o]);let p=[];if(d){if(""!=u&&null!=u&&(p=p.concat(u.split(",").map(e=>new Date(e)))),""!=m&&null!=m){const e=m.split(",");p.push({from:new Date(e[0]),to:new Date(e[1])})}if(""!=h&&null!=h){let e=h.split(",").map(e=>{let t=0;switch(e){case"sunday":t=0;break;case"monday":t=1;break;case"tuesday":t=2;break;case"wednesday":t=3;break;case"thursday":t=4;break;case"friday":t=5;break;case"saturday":t=6;break;default:t=0}return t});p.push((function(t){return e.indexOf(t.getDay())>-1}))}"disablingDates"==d?n.disable=p:n.enable=p}const g=a(e,n);e.isSameNode(r.target)&&g.open()}),e.forEach(e=>{e.removeEventListener("focus",t)})};e.forEach(e=>{e.addEventListener("focus",t)})},handleLoadIntlTelVendor:function(){return Promise.all([o.e(8),o.e(4)]).then(o.bind(null,83))},handlePhoneIntl:async function(e,t){const r=this,{default:o}=await this.handleLoadIntlTelVendor(),{intlTel:a}=o;t.forEach(t=>{r.phoneIntl=r.phoneIntl||{},r.phoneIntl[e]=r.phoneIntl[e]||{},void 0!==r.phoneIntl[e][t.name]&&r.phoneIntl[e][t.name].destroy(),r.phoneIntl[e][t.name]=a(t,{separateDialCode:!0,placeholderNumberType:"MOBILE",autoPlaceholder:"aggressive",utilsScript:Globo.FormBuilder.__webpack_public_path__+"globo.formbuilder.intlTel_utils.js",preferredCountries:[t.getAttribute("default-country-code")]})})},handleConditionalField:function(e){const t=this;e.forEach(e=>{const r=e.getAttribute("data-connected-id"),o=e.getAttribute("data-connected-value"),i=Object(a.a)(e,"form");let s=i.querySelectorAll('[name="'+r+'"]');s.length||(s=i.querySelectorAll('[name="'+r+'[]"]')),s.length&&s.forEach(r=>{r.checked&&t.handleSetConditionalField(r,e,o),r.addEventListener("change",(function(){t.handleSetConditionalField(r,e,o)}))})})},handleSetConditionalField:function(e,t,r){const o=this;"checkbox"==e.type?e.value===r&&(e.checked?(t.style.display="block",t.querySelectorAll("[name]").forEach(e=>{e.removeAttribute("disabled","disabled");const t=e.parentNode.querySelector(".flatpickr-mobile");t&&t.removeAttribute("disabled","disabled"),o.handleSetDefaultValue(e)})):(t.style.display="",t.querySelectorAll("[name]").forEach(e=>{e.setAttribute("disabled","disabled")}))):"radio"==e.type?e.value===r&&e.checked?(t.style.display="block",t.querySelectorAll("[name]").forEach(e=>{e.removeAttribute("disabled","disabled");const t=e.parentNode.querySelector(".flatpickr-mobile");t&&t.removeAttribute("disabled","disabled"),o.handleSetDefaultValue(e)})):(t.style.display="",t.querySelectorAll("[name]").forEach(e=>{e.setAttribute("disabled","disabled")})):e.value===r?(t.style.display="block",t.querySelectorAll("[name]").forEach(e=>{e.removeAttribute("disabled","disabled");const t=e.parentNode.querySelector(".flatpickr-mobile");t&&t.removeAttribute("disabled","disabled"),o.handleSetDefaultValue(e)})):(t.style.display="",t.querySelectorAll("[name]").forEach(e=>{e.setAttribute("disabled","disabled")}));const i=Object(a.a)(t,".panels"),s=Object(a.a)(t,".panel.movingIn");if(s&&(i.style.height=s.offsetHeight+"px"),"checkbox"==e.type&&!e.checked&&e.value==r||"radio"==e.type||"select-one"==e.type){const e=t.querySelectorAll("input[name],select"),r=document.createEvent("HTMLEvents");r.initEvent("change",!1,!0),e.forEach(e=>{"checkbox"==e.type||"radio"==e.type?e.checked=!1:e.value="",e.disabled?(e.disabled=!1,e.dispatchEvent(r),e.disabled=!0):e.dispatchEvent(r)})}},handleSetDefaultValue:function(e){setTimeout((function(){const t=e.closest(".globo-form-control").getAttribute("data-default-value");if(t&&"false"!==t){const r=document.createEvent("HTMLEvents");if(r.initEvent("change",!0,!0),"select-one"===e.type)e.value=t;else if("radio"===e.type)e.value===t&&(e.checked=!0);else if(-1!==e.name.indexOf("acceptTerms"))e.checked=!0;else{t.split(",").includes(e.value)&&(e.checked=!0)}e.dispatchEvent(r)}}),10)},handleHiddenField:function(e,t,r){let o=[];if(void 0===e)return!1;e.elements.forEach(e=>{"group"==e.type&&e.elements.forEach(e=>{"hidden"==e.type&&"dynamic"==e.dataType&&e.dynamicValue.length&&e.dynamicValue.forEach(t=>{t.target=e.id,o.includes(t)||o.push(t)})}),"hidden"==e.type&&"dynamic"==e.dataType&&e.dynamicValue.length&&e.dynamicValue.forEach(t=>{t.target=e.id,o.includes(t)||o.push(t)})}),r.forEach(e=>{if(void 0!==o.find(t=>t.when==e.name||t.when+"[]"==e.name)){const r=o.find(t=>t.when===e.name&&""==t.is);if(void 0!==r){const e=t.querySelector('[name="'+r.target+'"]');e&&(e.value=r.value)}e.addEventListener("change",(function(r){const a=r.target.value,i=o.find(t=>{if(t.is==a){if(t.when==e.name)return!0;if(t.when+"[]"==e.name&&e.checked)return!0}return!1});if(void 0!==i){const e=t.querySelector('[name="'+i.target+'"]');e&&(e.value=i.value)}else{const r=o.find(t=>t.when==e.name||t.when+"[]"==e.name);if(void 0!==r){const e=t.querySelector('[name="'+r.target+'"]');e&&(e.value=e.getAttribute("data-default-value"))}}}))}})},handleSubmit:function(e){e.preventDefault(),e.stopPropagation(),Globo.FormBuilder.handleValidate(e.target);if(e.target.querySelector(".block-container.errors"))return;const t=new CustomEvent("globo.formbuilder.form.submitting",{detail:{form:e.target,formId:e.target.getAttribute("data-id")}});document.dispatchEvent(t);var r=e.target.querySelector(".action.submit");r.classList.add("loading"),r.setAttribute("disabled","disabled");let o=e.target.closest(".globo-form-app").querySelectorAll(".message.success");var a=e.target.querySelectorAll("input, textarea, select"),i={"{{customer.name}}":Globo.FormBuilder.customer?Globo.FormBuilder.customer.name:"","{{customer.email}}":Globo.FormBuilder.customer?Globo.FormBuilder.customer.email:"","{{page.title}}":Globo.FormBuilder.page?Globo.FormBuilder.page.title:"","{{page.href}}":Globo.FormBuilder.page?Globo.FormBuilder.page.href:""};o.forEach((function(e){e.innerHTML=Globo.FormBuilder.addVariables(e.innerHTML,i,a)}));const s=e.target.querySelectorAll('[name="hidden"]');s&&s.forEach((function(e){if(e.value.indexOf("{{-")>-1&&e.value.indexOf("-}}")>-1){const t=e.value.replace("{{-","").replace("-}}","").split(".");e.value=void 0!==Globo.FormBuilder[t[0]]&&void 0!==Globo.FormBuilder[t[0]][t[1]]?Globo.FormBuilder[t[0]][t[1]]:""}}));let l=[];const n=e.target.querySelectorAll(".action--add-to-cart"),c=new Globo.FormBuilder.BulkOrder;let d=[];n.length&&n.forEach(e=>{e.checked&&(d=c.addItems(d,e))}),d.length&&void 0!==Globo.FormBuilder.page&&l.push(c.addProducts(d,e.target)),l.push(Globo.FormBuilder.xhr(e.target)),Promise.all(l).then(t=>{r.classList.remove("loading"),r.removeAttribute("disabled"),e.target.querySelectorAll(".message").forEach((function(e){e.style.display="none"}));let o="",s="";if(t.map(e=>{void 0!==e.items||"Cart Error"==e.message?o=e:s=e}),"true"==s.success){const r=new CustomEvent("globo.formbuilder.form.submitted",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t}});if(document.dispatchEvent(r),void 0!==o.items){const r=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].elements.find(e=>e.id="products");r.successMessage&&e.target.querySelectorAll(".message.success").forEach((function(e){e.querySelector(".content").insertAdjacentHTML("beforebegin","<h4>"+r.successMessage+"</h4></br>")}));var l=new CustomEvent("globo.formbuilder.bulkorder.added",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t,cartItem:o.items}});document.dispatchEvent(l)}else if("Cart Error"==o.message){e.target.querySelector(".message.warning .content").innerHTML=o.description}const s=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].afterSubmit;if("undefined"!=typeof ga&&s.enableGa){const e=Globo.FormBuilder.addVariables(s.gaEventCategory,i,a)||"",t=Globo.FormBuilder.addVariables(s.gaEventAction,i,a)||"",r=Globo.FormBuilder.addVariables(s.gaEventLabel,i,a)||"";ga("send",{hitType:"event",eventCategory:e,eventAction:t,eventLabel:r})}if("function"==typeof fbq&&s.enableFpx){const t=Globo.FormBuilder.addVariables(s.fpxTrackerName,i,a)||"GloboFormBuilder-Submit";fbq("trackCustom",t,{pageTitle:Globo.FormBuilder.page.title,pageHref:Globo.FormBuilder.page.href,formTitle:Globo.FormBuilder.forms[e.target.getAttribute("data-id")].header.title})}if("redirectToPage"==s.action&&window.setTimeout((function(){window.location.href=s.redirectUrl}),"undefined"!=typeof ga&&s.enableGa?1500:100),"clearForm"==s.action){e.target.reset(),Globo.FormBuilder.showMessage(e.target.querySelector(".message.success")),Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning")),void 0!==o.items&&Globo.FormBuilder.renderForm(e.target.getAttribute("data-id"),document.querySelectorAll(".globo-formbuilder"),[{success:e.target.querySelector(".message.success").outerHTML}]);const t=e.target.querySelector(".globo-g-recaptcha");t&&grecaptcha.reset(t.nextElementSibling.getAttribute("reCaptcha-widget-id"));const r=e.target.querySelector(".globo-formbuilder-wizard");if(r){new Globo.FormBuilder.Wizard(r).reset()}}if("hideForm"==s.action){e.target.style.display="none";const t=e.target.parentNode.querySelectorAll(".message.success");t&&Globo.FormBuilder.showMessage(t[t.length-1]),Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning"))}}else{const r=e.target.querySelector(".message.error .content"),a=void 0!==s.errors&&s.errors;if(a){let i="";for(var n=0;n<Object.keys(a).length;n++)if("string"==typeof a[n])i+='<div class="err-item"><span class="label"></span><span class="err">'+a[n]+"</span></div>";else{let t=e.target.querySelector('[name="_keyLabel"]');t&&(t=JSON.parse(t.value)),void 0!==t[Object.keys(a)[n]]?i+='<div class="err-item"><span class="label">'+t[Object.keys(a)[n]]+'</span> : <span class="err">'+a[Object.keys(a)[n]]+"</span></div>":i+='<div class="err-item"><span class="label"></span><span class="err">'+a[Object.keys(a)[n]]+"</span></div>"}if(void 0!==o.items){const r=Globo.FormBuilder.forms[e.target.getAttribute("data-id")].elements.find(e=>e.id="products");e.target.querySelectorAll(".message.success").forEach((function(e){e.querySelector(".content").innerHTML="<h4>"+r.successMessage+"</h4></br>"})),Globo.FormBuilder.showMessage(e.target.querySelector(".message.success"));l=new CustomEvent("globo.formbuilder.bulkorder.added",{detail:{form:e.target,formId:e.target.getAttribute("data-id"),response:t,cartItem:o.items}});document.dispatchEvent(l)}else if("Cart Error"==o.message){e.target.querySelector(".message.warning .content").innerHTML=o.description,Globo.FormBuilder.showMessage(e.target.querySelector(".message.warning"))}r.innerHTML=i;const s=e.target.querySelector(".globo-g-recaptcha");s&&grecaptcha.reset(s.nextElementSibling.getAttribute("reCaptcha-widget-id"))}Globo.FormBuilder.showMessage(e.target.querySelector(".message.error"));const i=[{success:e.target.querySelector(".message.success").outerHTML},{error:e.target.querySelector(".message.error").outerHTML}];void 0!==o.items&&void 0!==Globo.FormBuilder.page&&Globo.FormBuilder.renderForm(e.target.getAttribute("data-id"),document.querySelectorAll(".globo-formbuilder"),i)}})},xhr:function(e){const t=e.getAttribute("action"),r=e.getAttribute("method");let o=new FormData(e);const a=new FormData;let i,s=0;void 0!==o.fd&&(o=o.fd);for(const t of o)if(t[0].includes("select_product")){t[0]!==i&&(i=t[0],s=0);const r=JSON.parse(e.querySelector(`[name="${t[0]}"][value="${t[1]}"]`).nextElementSibling.innerHTML);a.append(t[0]+`[${s}][url]`,`https://${this.shop.url}/admin/products/${r.id}`),a.append(t[0]+`[${s}][name]`,r.title),s++}else{if(t[0].indexOf("products")>-1){const r=e.querySelector('.item__quantity[data-variant-id="'+t[1]+'"]');if(r){const e=t[0].split("-").length>1?"quantities-"+t[0].split("-")[1]:"quantities[]";a.append(e,t[1]+" / "+r.value)}}t[0].indexOf("phone")>-1&&void 0!==this.phoneIntl&&void 0!==this.phoneIntl[t[0]]&&(t[1]=this.phoneIntl[e.querySelector(".block-container").getAttribute("data-id")][t[0]].getNumber()),a.append(t[0],t[1])}return new Promise((o,i)=>{o(fetch(t,{method:r,body:a}).then((function(e){if(e.ok)return e.json();{const t=new Error(e.statusText);throw t.response=e,t}})).then(e=>e).catch(t=>{e.querySelector(".action.submit").classList.remove("loading");const r=e.querySelector(".message.error"),o=r.getAttribute("data-other-error"),a=e.querySelector(".message.error");a&&(a.innerHTML='<div class="err-item"><span class="label"></span><span class="err">'+(o||"Too many request, please try again later")+"</span></div>"),r&&this.showMessage(r)}))})},dismiss:function(e){e.parentNode.style.display="none";var t=e.closest(".message");if(t.classList.contains("success")){var r=e.closest(".g-container");t.innerHTML=Globo.FormBuilder.forms[r.getAttribute("data-id")].afterSubmit.message}},idealTextColor:function(e){const t=0===e.indexOf("#")?this.getRGBComponents(e):e.substring(5,e.length-1).replace(/ /g,"").split(",");return 255-(.299*t[0]+.587*t[1]+.114*t[2])<105?"#000000":"#ffffff"},getRGBComponents:function(e){const t=e.substring(1,3),r=e.substring(3,5),o=e.substring(5,7);return{R:parseInt(t,16),G:parseInt(r,16),B:parseInt(o,16)}},addVariables:function(t,r,o){var a=[];return t=t.replace(/{{customer.name}}|{{customer.email}}|{{page.title}}|{{page.href}}/g,(function(e){return r[e]})),o.length&&o.forEach(r=>{const o="checkbox"===r.type||"file"===r.type&&r.multiple?r.name.split("[")[0]:r.name;t.indexOf("{{"+o+"}}")>-1&&("radio"===r.type?t=t.replace("{{"+r.name+"}}",e.target.querySelector("[name="+r.name+"]:checked")?e.target.querySelector("[name="+r.name+"]:checked").value:""):"checkbox"===r.type?(a[o]=void 0!==a[o]?a[o]:[],r.checked&&a[o].push(r.value)):"file"===r.type?r.multiple?(a[o]=void 0!==a[o]?a[o]:[],r.files.length&&Object.values(r.files).map(e=>{a[o].push(e.name)})):t=t.replace("{{"+r.name+"}}",r.value?r.value.split("fakepath\\")[1]:""):t=t.replace("{{"+r.name+"}}",r.value))}),Object.keys(a).length>0&&Object.entries(a).map(e=>{t.indexOf("{{"+e[0]+"}}")>-1&&(t=t.replace("{{"+e[0]+"}}",e[1]))}),t}};r.default=u}}]);